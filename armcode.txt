package frc.robot;

import com.revrobotics.REVLibError;
import com.revrobotics.RelativeEncoder;
import com.ctre.phoenix.motorcontrol.ControlMode;
import com.ctre.phoenix.motorcontrol.NeutralMode;
import com.ctre.phoenix.motorcontrol.can.TalonSRX;
import com.revrobotics.CANSparkMax;
import com.revrobotics.CANSparkMax.IdleMode;
import com.revrobotics.CANSparkMaxLowLevel.MotorType;

import edu.wpi.first.wpilibj.TimedRobot;
import edu.wpi.first.wpilibj.DoubleSolenoid;
import edu.wpi.first.wpilibj.Encoder;
import edu.wpi.first.wpilibj.Joystick;
import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import edu.wpi.first.wpilibj.SPI;
import edu.wpi.first.wpilibj.motorcontrol.Talon;
import edu.wpi.first.wpilibj.Timer;
import edu.wpi.first.wpilibj.DigitalInput;
import edu.wpi.first.cscore.UsbCamera;
import edu.wpi.first.math.controller.PIDController;
import edu.wpi.first.cameraserver.CameraServer;

import java.nio.Buffer;
import java.rmi.server.Operation;

//import com.ctre.phoenix.motorcontrol.ControlMode;
//import com.ctre.phoenix.motorcontrol.can.TalonSRX;
import edu.wpi.first.wpilibj.Ultrasonic;
import edu.wpi.first.wpilibj.DoubleSolenoid.Value;
import edu.wpi.first.wpilibj.GenericHID.RumbleType;
import edu.wpi.first.wpilibj.Joystick.AxisType;
import edu.wpi.first.wpilibj.interfaces.Gyro;
import edu.wpi.first.wpilibj.AnalogGyro;
//import edu.wpi.first.wpilibj.interfaces.Potentiometer;
import edu.wpi.first.wpilibj.AnalogInput;
import edu.wpi.first.wpilibj.AnalogPotentiometer;
//import com.kauailabs.navx.frc.AHRS;

import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import edu.wpi.first.networktables.NetworkTable;
import edu.wpi.first.networktables.NetworkTableEntry;
import edu.wpi.first.networktables.NetworkTableInstance;
//TODO
// import edu.wpi.first.wpilibj.PIDController;
import edu.wpi.first.wpilibj.PneumaticsModuleType;
import edu.wpi.first.wpilibj.RobotController;
import edu.wpi.first.wpilibj.RobotState;

//import edu.wpi.first.hal.PDPJNI;
import edu.wpi.first.wpilibj.Compressor;
// import edu.wpi.first.wpilibj.motorcontrol.Spark;

public class Robot extends TimedRobot {

	// Classes
	public Arm arm = new Arm();
	// Sensors

	public Gyro driveTrainGryo = new AnalogGyro(0);
	public RelativeEncoder encoderTestMotor;

	public double setPointArm = 0;
	// Drivetrain
	public DriveTrain driveTrain = new DriveTrain(0, 1, 2, 3);
	// Motors
	private CANSparkMax motor_gripper;

	// Logic
	public boolean open = true;

	// Joysticks
	public Joystick operator = new Joystick(1);
	public Joystick flightStickLeft = new Joystick(2);
	public Joystick flightStickRight = new Joystick(3);

	public void robotInit() {
		motor_gripper = new CANSparkMax(5, MotorType.kBrushless);

	}

	public void disabledInit() {
		driveTrain.SetBreak();
	}

	public void autonomousInit() {
	}

	public void autonomousPeriodic() {
	}

	public void teleopInit() {

		operator = new Joystick(1);
		flightStickRight = new Joystick(2);
		flightStickLeft = new Joystick(3);

	}

	public void teleopPeriodic() {

		float speed = 1.0f;

		if (operator.getRawButton(2)) {
			open = true;
			motor_gripper.set(speed / 3);
		} else if (operator.getRawButton(3)) {
			open = false;
			motor_gripper.set(-speed / 2);
		} else if (open) {
			motor_gripper.set(0.0f);
		}

		if (flightStickLeft.getRawButtonPressed(1)) {
			setPointArm = setPointArm + 0.1;
		} else if (flightStickRight.getRawButtonPressed(1)) {
			setPointArm = setPointArm - 0.1;
		}
		arm.SetPoint(setPointArm);
		arm.Update(operator.getRawAxis(1));
		arm.debug();
		if (operator.getRawButton(2)) {
			arm.PowerManual(0);
		}
		driveTrain.SetCoast();
		ControllerDrive();
		driveTrain.Update();

	}

	public void testInit() {
		driveTrainGryo.reset();
	}

	public void testPeriodic() {
		arm.PowerManual(0);
		arm.ResetEncoder();

		// encoderTestMotor = testMotor.getEncoder();
		// testMotor.setIdleMode(IdleMode.kCoast);
		// System.out.println(encoderTestMotor.getVelocity());
		// testMotor.set(0);
		// 0.0621
		// motorArm.set(ControlMode.PercentOutput,
		// (-flightStickLeft.getRawAxis(1)*10/RobotController.getBatteryVoltage()));

		// System.out.println(-flightStickLeft.getRawAxis(1)*10/RobotController.getBatteryVoltage());

		// System.out.println(driveTrainGryo.getAngle() + " gryo");
		// if(driveTrainGryo.getAngle() <= 90){
		// driveTrain.SetLeftSpeed(0.3f);
		// driveTrain.SetRightSpeed(-0.3f);
		// // System.out.println("TRying but failing");
		// }else{
		// driveTrain.SetBothSpeed(0);
		// }
		// driveTrain.Update();
	}

	public void CompressorsOn() {
	}

	public void CompressorOff() {
	}

	public float TranslateController(float input) {
		float deadzone = 0.00f;
		if (input > -deadzone && input < deadzone) {
			input = 0.05f;
		}
		float a = 0.7f;
		float output = (a * input * input * input) + (1 - a) * input;
		return output;
	}

	public void ControllerDrive() {
		float leftJoystick = (float) flightStickLeft.getRawAxis(1);
		float rightJoystick = (float) flightStickRight.getRawAxis(0);

		driveTrain.SetRightSpeed(-leftJoystick + -rightJoystick);
		driveTrain.SetLeftSpeed(-leftJoystick + rightJoystick);

		// float horJoystick = TranslateController((float)
		// flightStickLeft.getRawAxis(0));
		// float verJoystick = TranslateController((float)
		// -flightStickRight.getRawAxis(1));

		// driveTrain.SetRightSpeed(-verJoystick + -horJoystick);
		// driveTrain.SetLeftSpeed(-verJoystick + horJoystick);
		// System.out.println(-verJoystick + -horJoystick);

		driveTrain.SetCoast();
	}

	public void DrivetrainBrakes(boolean brakes) {
		if (brakes = true) {
			driveTrain.SetBreak();
		} else {
			driveTrain.SetCoast();
		}
	}
}